# 游览器的工作原理（CSS 规则在节点上的应用）

#### 整体过程

-  CSS 规则不是 DOM 树构建好了以后，再进行选择并给它添加样式的。
- 构建 DOM 的过程是从父到子，从先到后，一个一个节点构造并且挂载到 DOM 树上的，在这个过程中依次拿到上一步构造好的元素，去检查它匹配到了哪些规则，再根据规则的优先级，做覆盖和调整。我们可以把选择器理解成“匹配器”。

#### 选择器

我们常见的选择有：

```
空格: 后代，选中它的子节点和所有子节点的后代节点。
> : 子代，选中它的子节点。
+：直接后继选择器，选中它的下一个相邻节点。
~：后继，选中它之后所有的相邻节点。
||：列，选中表格中的一列。
```

我们可以发现，这里的选择器有个特点，那就是选择器的出现顺序，必定跟构建 DOM 树的顺序一致。

##### 后代选择器 “空格”

```
a#b .cls {
    width: 100px;
}
```

```
<a id=b>
    <span>1<span>
    <span class=cls>2<span>
</a>
<span class=cls>3<span>
```

##### 后继选择器“ ~ ”

后继选择器跟后代选择器不同的地方是，后继选择器只作用于一层：

```
.cls~* {
    border:solid 1px green;
}
<div>
<span>1<span>
<span class=cls>2<span>
<span>
    3
    <span>4</span>
<span>
<span>5</span>
</div>
```

这里 .cls 选中了 span 2    然后 span 3 是它的后继，但是 span 3 的子节点 span 4 并不应该被选中，而 span 5 也是它的后继，因此应该被选中。

按照 DOM 树的构造顺序，4 在 3 和 5 中间，我们就没有办法像前面讲的后代选择器一样通过激活或者关闭规则来实现匹配。

但是这里有个非常方便的思路，就是给选择器的激活，带上一个条件：父元素。

注意：这里后继选择器，当前半段的 .cls 匹配成功时，后续 * 所匹配的所有元素的父元素都已经确定了（后继节点和当前节点父元素相同是充分必要条件）那个 div 就是后继节点的父元素。

##### 子代选择器“ >”

```
div>.cls {
    border:solid 1px green;
}
<div>
<span>1<span>
<span class=cls>2<span>
<span>
    3
    <span>4</span>
<span>
<span>5</span>
</div>
```

##### 直接后继选择器“ +”

紧跟其后的兄弟选择器，且只选择一个

```
.cls + span {
    border:solid 1px green;
}
<div>
<span>1<span>
<span class=cls>2<span>
<span>
    3
    <span>4</span>
<span>
<span>5</span>
</div>
```

##### 列选择器“ || ”

未找到细致讲解，只知道他是针对表格的选择器，欢迎补充。

##### 或关系选择器 “，”

```
a#b, .cls {

}
```

等于

```
a#b {

}
.cls {

}
```

实际上可以把选择器想象成树，只是这个树需要连接符。



css3相关选择器地址：https://www.w3school.com.cn/cssref/css_selectors.asp